<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<title>wikiradio</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="wikiradio.css" media="screen" />
</head>

<body>

<h1>wikiradio</h1>

<p>Estás escuchando: <span id="audioDescription"></span></p>

<audio id="audioPlayer">
Your browser does not support the HTML5 Audio element.
</audio>

<audio id="audioPlayerAux">
Your browser does not support the HTML5 Audio element.
</audio>

<p id="data"></p>

<script type="text/javascript">
var ArraySongs = [
["Antonio Vivaldi - Concerto for Two Violins in D minor Op. 3 No. 11", "Antonio Vivaldi - Concerto for Two Violins in D minor Op. 3 No. 11 - 1. Allegro - Adagio e spiccato - Allegro.ogg", "32", 237], 
["Beethoven - Symphonie 5 c-moll - 1", "Ludwig van Beethoven - Symphonie 5 c-moll - 1. Allegro con brio.ogg", "5b", 436], 
["Claude Debussy - La fille aux cleveux de lin", "Claude Debussy - La fille aux cleveux de lin - David Hernando Vitores - Kayoko Morimoto (Wasei Duo).ogg", "47", 135],
["Claude Debussy - Menuet Nº3 de la petite Suite", "Claude Debussy - Menuet Nº3 de la petite Suite - David Hernando Vitores - Kayoko Morimoto (Wasei Duo).ogg",  "7a", 161], 
["Claude Debussy - Rêverie - Arr for Soprano saxophone and piano", "Claude Debussy - Rêverie - Arr for Soprano saxophone and piano - David Hernando Vitores.ogg", "c0", 281], 
]
var totalLength = 0;
for (var i=0;i<ArraySongs.length;i++) {
    totalLength += ArraySongs[i][3];
}
var date = new Date();
var dateutc = date.toUTCString();
var data = document.getElementById('data');
var epoch = Math.round(new Date() / 1000);
var diffsec = epoch % totalLength;
//data.innerHTML = 'UTC: ' + dateutc + '<br/>Epoch: ' + epoch + '<br/>Total length: ' + totalLength + '<br/>%: ' + diffsec;

var audioPlayer = document.getElementById('audioPlayer');
var audioDescription = document.getElementById('audioDescription');
var audioPlayerAux = document.getElementById('audioPlayerAux');

var songID = 0;
for (var i=0;i<ArraySongs.length;i++) {
    songID = i;
    if (diffsec <= ArraySongs[i][3]) {
        playSongFrom();
        break;
    }else{
        diffsec -= ArraySongs[i][3];
    }
}

hourlySignal();

function playSong(){
    audioDescription.innerHTML = '<a href="https://commons.wikimedia.org/wiki/File:' + ArraySongs[songID][1].replace(/ /g,'_') + '">' + ArraySongs[songID][0] + '</a>';
    audioPlayer.src = 'https://upload.wikimedia.org/wikipedia/commons/' + ArraySongs[songID][2][0] + '/' + ArraySongs[songID][2] + '/' + ArraySongs[songID][1].replace(/ /g,'_');
    audioPlayer.play();
    audioPlayer.ondurationchange = function() {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;
        audioPlayer.play();
    }
    audioPlayer.onended = function(){
        if (songID < ArraySongs.length - 1) {
            songID++;
        } else {
            songID = 0;
        }
        playSong();
    }
}

function playSongFrom(){
    playSong();
    audioPlayer.ondurationchange = function() {
        audioPlayer.pause();
        audioPlayer.currentTime = diffsec;
        audioPlayer.play();
    }
}

function playHourlySignal(){
    audioPlayerAux.src = 'https://upload.wikimedia.org/wikipedia/commons/2/26/Busy_tone_%28France%29.ogg';
    audioPlayerAux.play();
    setTimeout(hourlySignal, 5000);
}

function hourlySignal(){
    var d = new Date();
    var min = d.getMinutes();
    var sec = d.getSeconds();

    if ((min == '59') && (sec == '59')) {
        playHourlySignal();
    }else{
        setTimeout(playHourlySignal,(60*(59-min)+(59-sec))*1000);
    }
}
</script>

</body>

</html>
