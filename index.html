<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<title>wikiradio</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="wikiradio.css" media="screen" />
</head>

<body>

<h1>wikiradio</h1>

<p>Estás escuchando: <span id="audioDescription"></span></p>

<audio id="audioPlayer">
Your browser does not support the HTML5 Audio element.
</audio>

<p id="data"></p>

<script type="text/javascript">
var ArraySongs = [
["La fille aux cleveux de lin", "Claude Debussy - La fille aux cleveux de lin - David Hernando Vitores - Kayoko Morimoto (Wasei Duo).ogg", "47", 135],
["Menuet Nº3 de la petite Suite", "Claude Debussy - Menuet Nº3 de la petite Suite - David Hernando Vitores - Kayoko Morimoto (Wasei Duo).ogg",  "7a", 161], 
["Rêverie - Arr for Soprano saxophone and piano", "Claude Debussy - Rêverie - Arr for Soprano saxophone and piano - David Hernando Vitores.ogg", "c0", 281], 
]
var totalLength = 0;
for (var i=0;i<ArraySongs.length;i++) {
    totalLength += ArraySongs[i][3];
}
var date = new Date();
var dateutc = date.toUTCString();
var data = document.getElementById('data');
var epoch = Math.round(new Date() / 1000);
var diffsec = epoch % totalLength;
data.innerHTML = 'UTC: ' + dateutc + '<br/>Epoch: ' + epoch + '<br/>Total length: ' + totalLength + '<br/>%: ' + diffsec;

var songID = 0;
for (var i=0;i<ArraySongs.length;i++) {
    songID = i;
    if (diffsec <= ArraySongs[i][3]) {
        playthisfrom(songID, diffsec);
        break;
    }else{
        diffsec -= ArraySongs[i][3];
    }
}

var audioPlayer = document.getElementById('audioPlayer');
audioPlayer.onended = function(){
    if (songID < ArraySongs.length - 1) {
        songID++;
    } else {
        songID = 0;
    }
    playthis(songID);
}

function playthis(songID){
    document.write('Playing ' + ArraySongs[songID][0] + ' from ' + diffsec);
    var audioPlayer = document.getElementById('audioPlayer');
    var audioDescription = document.getElementById('audioDescription');
    
    audioDescription.innerHTML = '<a href="https://commons.wikimedia.org/wiki/File:' + ArraySongs[songID][1].replace(/ /g,'_') + '">' + ArraySongs[songID][0] + '</a>';
    audioPlayer.src = 'https://upload.wikimedia.org/wikipedia/commons/' + ArraySongs[songID][2][0] + '/' + ArraySongs[songID][2] + '/' + ArraySongs[songID][1].replace(/ /g,'_');
    audioPlayer.play();
}

function playthisfrom(songID, diffsec){
    playthis(songID);
    var audioPlayer = document.getElementById('audioPlayer');
    audioPlayer.ondurationchange = function() {
        audioPlayer.pause();
        audioPlayer.currentTime = diffsec;
        audioPlayer.play();
    }
}
</script>

</body>

</html>
